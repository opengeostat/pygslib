

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial: Resource estimation with PyGSLIB &mdash; PyGSLIB 0.0.0.3.9 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/opengeostat_fab.png"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PyGSLIB API autogenerated documentation!" href="API.html" />
    <link rel="prev" title="Welcome to PyGSLIB documentation!" href="index.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PyGSLIB
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0.3.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial: Resource estimation with PyGSLIB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-python-packages">Loading python packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-the-drillhole-tables">Loading the drillhole tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-drillhole-object">Creating drillhole object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compositing">Compositing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#desurveying">Desurveying</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-bhid-of-type-integer">Creating a BHID of type integer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rendering-drillhole-intervals-in-paraview-and-exporting-drillhole-data">Rendering drillhole intervals in Paraview and exporting drillhole data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tagging-samples-with-domain-code">Tagging samples with domain code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#block-modeling">Block modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-basic-stats">Some basic stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variography">Variography</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estimating-cu-grade-in-one-block">Estimating Cu grade in one block</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estimating-in-all-blocks">Estimating in all blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validating-the-results">Validating the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-swath-plots">Create swath plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="#global-change-of-support">Global change of support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fitting-the-point-cdf-with-hermite-polynomials">Fitting the point CDF with hermite polynomials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-the-support-effect">Calculate the support effect</a></li>
<li class="toctree-l3"><a class="reference internal" href="#correcting-the-support-effect-on-the-cdf">Correcting the support effect on the CDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-grade-tonnage-curves">Calculate grade tonnage curves</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API.html">PyGSLIB API autogenerated documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyGSLIB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial: Resource estimation with PyGSLIB</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Tutorial.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-resource-estimation-with-pygslib">
<span id="tutorial-resource-estimation-with-pygslib"></span><h1>Tutorial: Resource estimation with PyGSLIB<a class="headerlink" href="#tutorial-resource-estimation-with-pygslib" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will guide you on doing resource estimation with PyGSLIB.
The informing data is from the <a class="reference external" href="www.nrri.umn.edu/egg/REPORTS/TR200321/TR200321.html">BABBITT zone of the KEWEENAWAN DULUTH
COMPLEX</a>.</p>
<p>The sequence of data preparation and estimation used in this example is
as follows:</p>
<ul class="simple">
<li>import drillhole tables</li>
<li>create a drillhole object</li>
<li>composite drillhole intervals</li>
<li>desurvey drillholes</li>
<li>code drillholes with domains</li>
<li>declustering and basic statistics</li>
<li>create a block model</li>
<li>populate a wireframe domain with blocks</li>
<li>estimate with ordinary kriging</li>
<li>basic model validation</li>
</ul>
<p>To run this demo in your computer download and unpack <a class="reference external" href="Tutorial_files/Tutorial_1.tar">the demo
files</a>.</p>
<div class="section" id="prerequisites">
<span id="prerequisites"></span><h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>You will need <code class="docutils literal notranslate"><span class="pre">pygslib</span></code> and <code class="docutils literal notranslate"><span class="pre">paraview</span></code> to complete this excercise.
You can install <code class="docutils literal notranslate"><span class="pre">pygslib</span></code> with the command
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">opengeostat</span> <span class="pre">pygslib</span></code>, assuming that you use conda or miniconda.</p>
<p>You may also <a class="reference external" href="https://www.paraview.org/download/">download Paraview and install</a>.
Another alternative is Mayavy, but we find the Paraview is easier to install
and more powerful. Paraview can be used to process data, for example,
to extract grade shell wireframes from block models in VTK format.</p>
<p>To follow this tutorial you may be familiar with:</p>
<ul class="simple">
<li>Python 2.7 or 3.6</li>
<li>Python Data Analysis Library <a class="reference external" href="https://pandas.pydata.org/">Pandas</a>.
PyGSLIB was designed to work with Pandas.</li>
<li><a class="reference external" href="https://matplotlib.org/">Matplotlib</a></li>
<li><a class="reference external" href="https://www.paraview.org/">Paraview</a>, an open-source,
multi-platform data analysis and visualization application.</li>
<li><a class="reference external" href="https://g.co/kgs/dJj6RB">GSLIB</a>, geostatistics and mineral resource estimation.</li>
</ul>
</div>
<div class="section" id="loading-python-packages">
<span id="loading-python-packages"></span><h2>Loading python packages<a class="headerlink" href="#loading-python-packages" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># import third party python libraries</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># make plots inline in Ipython Notebooks/QT terminal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># %matplotlib inline</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># import pygslib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pygslib</span>
</pre></div>
</div>
<p>Need some help? Just type <code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">(pygslib.__doc__)</span></code> or go to <a class="reference external" href="https://opengeostat.github.io/pygslib/">the PyGSLIB online manual</a></p>
<p>You may want having a look at
<a class="reference external" href="https://github.com/opengeostat/pygslib/wiki">pygslib wikies</a>, if you are
interested in some technical and implementation details.</p>
<p>Finally <a class="reference external" href="https://github.com/opengeostat/pygslib">look into the code</a>,
it is free and clean, sometimes…</p>
</div>
<div class="section" id="loading-the-drillhole-tables">
<span id="loading-the-drillhole-tables"></span><h2>Loading the drillhole tables<a class="headerlink" href="#loading-the-drillhole-tables" title="Permalink to this headline">¶</a></h2>
<p>PyGSLIB only understands drillholes tables loaded into <code class="docutils literal notranslate"><span class="pre">Pandas.DataFrames</span></code>.
Two tables are compulsory:</p>
<ul class="simple">
<li>the collar, with the compulsory fields
<code class="docutils literal notranslate"><span class="pre">['BHID',</span> <span class="pre">'XCOLLAR',</span> <span class="pre">'YCOLLAR',</span> <span class="pre">'ZCOLLAR']</span></code> and the optional field <code class="docutils literal notranslate"><span class="pre">'LENGTH'</span></code></li>
<li>and survey, with the compulsory fields <code class="docutils literal notranslate"><span class="pre">['BHID',</span> <span class="pre">'AT',</span> <span class="pre">'AZ',</span> <span class="pre">'DIP']</span></code></li>
</ul>
<p>In addition, you may have any number of optional interval tables with
the compulsory fields <code class="docutils literal notranslate"><span class="pre">['BHID',</span> <span class="pre">'FROM',</span> <span class="pre">'TO']</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># importing data from file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collar</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;collar_BABBITT.csv&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">survey</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;survey_BABBITT.csv&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assay</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;assay_BABBITT.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">collar</span></code>, <code class="docutils literal notranslate"><span class="pre">survey</span></code> and <code class="docutils literal notranslate"><span class="pre">assay</span></code> are loaded as <code class="docutils literal notranslate"><span class="pre">Pandas.DataFrames</span></code> objects</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">collar</span><span class="p">))</span>
<span class="go">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span>
</pre></div>
</div>
<p>You can see the columns types and plot the tables as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">collar</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="go">BHID        object</span>
<span class="go">XCOLLAR    float64</span>
<span class="go">YCOLLAR    float64</span>
<span class="go">ZCOLLAR    float64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">collar</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">     BHID     XCOLLAR    YCOLLAR  ZCOLLAR</span>
<span class="go">0   34873  2296021.09  414095.85   1590.0</span>
<span class="go">1  B1-001  2294148.20  420495.90   1620.9</span>
<span class="go">2  B1-002  2296769.50  422333.50   1553.0</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">survey</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">     BHID   AT   AZ   DIP</span>
<span class="go">0   34873  0.0    0  90.0</span>
<span class="go">1  B1-001  0.0  327  60.0</span>
<span class="go">2  B1-002  0.0  327  60.0</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">assay</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">    BHID    FROM      TO    CU    NI   S  FE</span>
<span class="go">0  34873     0.0  2515.0   NaN   NaN NaN NaN</span>
<span class="go">1  34873  2515.0  2517.4  0.03  0.08 NaN NaN</span>
<span class="go">2  34873  2517.4  2518.9  0.04  0.10 NaN NaN</span>
</pre></div>
</div>
<p>Pandas provides a large set of functions to modify your data. Lets
remove some columns and make non-assayed intervals equal to zero.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># dropping some columns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assay</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;NI&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;FE&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># making non-sampled intervals equal to zero</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assay</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">assay</span><span class="p">[</span><span class="s1">&#39;CU&#39;</span><span class="p">]),</span> <span class="s1">&#39;CU&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-drillhole-object">
<span id="creating-drillhole-object"></span><h2>Creating drillhole object<a class="headerlink" href="#creating-drillhole-object" title="Permalink to this headline">¶</a></h2>
<p>To get access to the drillhole functions implemented in PyGSLIB, such as
desurvey and compositing, you need to create a drillhole object (an
instance of the class <code class="docutils literal notranslate"><span class="pre">Drillhole</span></code>, defined on the submodule
<code class="docutils literal notranslate"><span class="pre">gslib.drillhole</span></code>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#creating a drillhole object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">drillhole</span><span class="o">.</span><span class="n">Drillhole</span><span class="p">(</span><span class="n">collar</span><span class="o">=</span><span class="n">collar</span><span class="p">,</span> <span class="n">survey</span><span class="o">=</span><span class="n">survey</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># now you can add as many interval tables as you want, for example, assays, lithology and RQD.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">addtable</span><span class="p">(</span><span class="n">assay</span><span class="p">,</span> <span class="s1">&#39;assay&#39;</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="go">UserWarning: ! Collar table without LENGTH field</span>
</pre></div>
</div>
<p>The output above is a warning message. This one is a complain because
the field <code class="docutils literal notranslate"><span class="pre">LENGTH</span></code> was not included in the collar table. You will see
similar warnings any time PyGSLIB detects a potential issue in your
data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># validating a drillhole object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="go">UserWarning: ! survey with one value at BHID: 34873. This will produce error at desurvey</span>
<span class="go">UserWarning: ! survey with one value at BHID: B1-001. This will produce error at desurvey</span>
</pre></div>
</div>
<p>The warning above is serious. There are drillholes with only one survey record and to desurvey we need at least two records, the first one may be at the collar of the drillhole.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># fixing the issue of single interval at survey table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">fix_survey_one_interval_err</span><span class="p">(</span><span class="mf">90000.</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: To validate interval tables you may use the function
<code class="docutils literal notranslate"><span class="pre">validate_table</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># validating interval tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">validate_table</span><span class="p">(</span><span class="s1">&#39;assay&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="compositing">
<span id="compositing"></span><h2>Compositing<a class="headerlink" href="#compositing" title="Permalink to this headline">¶</a></h2>
<p>Before doing any statistical or geostatistical analysis you may verify
that all samples have approximately the same length. If samples have
different lengths you may “resample” the drillhole intervals using a
compositing algorithm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculating length of sample intervals</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;Length&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;TO&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;FROM&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># printing length mode</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="s1">&#39;The Length Mode is:&#39;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;Length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">The Length Mode is: 10.0</span>
</pre></div>
</div>
<p><img alt="" src="_images/tutorial_25_1.png" /></p>
<p>Most samples (the mode) are 10 ft length. This value or any of its
multiples are good options of composite length, they minimize the
over-splitting of sample intervals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># compositing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">downh_composite</span><span class="p">(</span><span class="s1">&#39;assay&#39;</span><span class="p">,</span>
<span class="go">                              variable_name= &quot;CU&quot;,</span>
<span class="go">                              new_table_name= &quot;CMP&quot;,</span>
<span class="go">                              cint = 10,</span>
<span class="go">                              minlen=-1,</span>
<span class="go">                              overwrite = True)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># first 5 rows of a table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="go">            BHID   CU    FROM      TO  _acum  _len</span>
<span class="go">54184  RMC-66313  0.0   970.0   980.0    0.0  10.0</span>
<span class="go">54185  RMC-66313  0.0   980.0   990.0    0.0  10.0</span>
<span class="go">54186  RMC-66313  0.0   990.0  1000.0    0.0  10.0</span>
<span class="go">54187  RMC-66313  0.0  1000.0  1010.0    0.0  10.0</span>
<span class="go">54188  RMC-66313  0.0  1010.0  1020.0    0.0   7.0</span>
</pre></div>
</div>
<p>Note that some especial fields were created, those fields have prefix
<code class="docutils literal notranslate"><span class="pre">_</span></code>. <code class="docutils literal notranslate"><span class="pre">_acum</span></code> is the grade accumulated in the composite interval (sum
of grades from sample intervals contributing to the composite interval)
and <code class="docutils literal notranslate"><span class="pre">_len</span></code> is the actual length of the composite.</p>
<p>In the table CMP the interval at row 54188 has <code class="docutils literal notranslate"><span class="pre">FROM</span> <span class="pre">:</span> <span class="pre">1010.0</span></code> and <code class="docutils literal notranslate"><span class="pre">TO:</span> <span class="pre">1020.0</span></code> but the sample length is only <code class="docutils literal notranslate"><span class="pre">7.0</span> <span class="pre">ft</span></code>. In this way the <code class="docutils literal notranslate"><span class="pre">FROM</span></code>
and <code class="docutils literal notranslate"><span class="pre">TO</span></code> intervals of any drillhole or table are always at the same
position and you can safely use the fields <code class="docutils literal notranslate"><span class="pre">['BHID',</span> <span class="pre">'FROM']</span></code> to merge
tables.</p>
</div>
<div class="section" id="desurveying">
<span id="desurveying"></span><h2>Desurveying<a class="headerlink" href="#desurveying" title="Permalink to this headline">¶</a></h2>
<p>To plot drillholes in 3D or to estimate grade values you need to
calculate the coordinates of the composites. This process is known as
<em>desurvey</em>. There are many techniques to desurvey, PyGSLIB uses <code class="docutils literal notranslate"><span class="pre">minimum</span> <span class="pre">curvature</span></code> and <code class="docutils literal notranslate"><span class="pre">balanced</span> <span class="pre">tangential</span></code>.</p>
<p>Desurvey will add the fields <code class="docutils literal notranslate"><span class="pre">azm,</span> <span class="pre">dipm</span></code> and <code class="docutils literal notranslate"><span class="pre">xm,</span> <span class="pre">ym,</span> <span class="pre">zm</span></code>, these are
directions and the coordinates at the mid point of composite intervals.
You have the option to add endpoint coordinates <code class="docutils literal notranslate"><span class="pre">xb,</span> <span class="pre">yb,</span> <span class="pre">zb</span></code> and
<code class="docutils literal notranslate"><span class="pre">xe,</span> <span class="pre">ye,</span> <span class="pre">ze</span></code>, these are required to export drillholes to Paraview (in
vtk format).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># desurveying an interval table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">desurvey</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">,</span><span class="n">warns</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">endpoints</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># first 3 rows of a table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="go">    BHID   CU  FROM    TO  _acum  _len  azm  dipm         xm            ym</span>
<span class="go">0  34873  0.0   0.0  10.0    0.0  10.0  0.0  90.0  2296021.0  414095.84375</span>
<span class="go">1  34873  0.0  10.0  20.0    0.0  10.0  0.0  90.0  2296021.0  414095.84375</span>
<span class="go">2  34873  0.0  20.0  30.0    0.0  10.0  0.0  90.0  2296021.0  414095.84375</span>

<span class="go">       zm         xb            yb      zb         xe            ye      ze</span>
<span class="go">0  1585.0  2296021.0  414095.84375  1590.0  2296021.0  414095.84375  1580.0</span>
<span class="go">1  1575.0  2296021.0  414095.84375  1580.0  2296021.0  414095.84375  1570.0</span>
<span class="go">2  1565.0  2296021.0  414095.84375  1570.0  2296021.0  414095.84375  1560.0</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-bhid-of-type-integer">
<span id="creating-a-bhid-of-type-integer"></span><h2>Creating a BHID of type integer<a class="headerlink" href="#creating-a-bhid-of-type-integer" title="Permalink to this headline">¶</a></h2>
<p>The GSLIB FORTRAN code can not handle data of type <code class="docutils literal notranslate"><span class="pre">str</span></code>,
sometimes you need to transform the <code class="docutils literal notranslate"><span class="pre">BHID</span></code> to type <code class="docutils literal notranslate"><span class="pre">int</span></code>, for example,
to use the condition <code class="docutils literal notranslate"><span class="pre">maximum</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">samples</span> <span class="pre">per</span> <span class="pre">drillholes</span></code> in <code class="docutils literal notranslate"><span class="pre">kriging</span></code>.
The function <code class="docutils literal notranslate"><span class="pre">txt2intID</span></code> will do this work for you.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># creating BHID of type integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">txt2intID</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># first 3 rows of a subtable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][[</span><span class="s1">&#39;BHID&#39;</span><span class="p">,</span> <span class="s1">&#39;BHIDint&#39;</span><span class="p">,</span> <span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="s1">&#39;TO&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="go">            BHID  BHIDint    FROM      TO</span>
<span class="go">54186  RMC-66313      399   990.0  1000.0</span>
<span class="go">54187  RMC-66313      399  1000.0  1010.0</span>
<span class="go">54188  RMC-66313      399  1010.0  1020.0</span>
</pre></div>
</div>
</div>
<div class="section" id="rendering-drillhole-intervals-in-paraview-and-exporting-drillhole-data">
<span id="rendering-drillhole-intervals-in-paraview-and-exporting-drillhole-data"></span><h2>Rendering drillhole intervals in Paraview and exporting drillhole data<a class="headerlink" href="#rendering-drillhole-intervals-in-paraview-and-exporting-drillhole-data" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>PyGSLIB can export drillhole intervals to VTK. Drag and drop the VTK
file on Paraview to see the drillholes in 3D. For a better image quality
add a <code class="docutils literal notranslate"><span class="pre">tube</span></code> filter and update the color scale.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># exporting results to VTK</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">export_core_vtk_line</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp.vtk&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is how it looks in Paraview</p>
<p><img alt="" src="_images/figure1.jpg" /></p>
<p>Interval tables are stored as a python dictionary of <code class="docutils literal notranslate"><span class="pre">{'Table</span> <span class="pre">Name'</span> <span class="pre">:</span> <span class="pre">Pandas.Dataframes}</span></code>. To export data to *.csv format use the Pandas
function <code class="docutils literal notranslate"><span class="pre">Dataframe.to_csv</span></code>. You can also export to any other format
supported by Pandas, <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html">this is the list of formats
supported</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># inspecting interval tables in drillhole object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Table names &quot;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table_mames</span><span class="p">)</span>
<span class="gp">... </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Tables names&quot;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="gp">... </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Table is    &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">))</span>

<span class="go">Table names  [&#39;assay&#39;, &#39;CMP&#39;]</span>
<span class="go">Tables names [&#39;assay&#39;, &#39;CMP&#39;]</span>
<span class="go">Table is     &lt;type &#39;dict&#39;&gt;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># exporting to csv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;cmp.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tagging-samples-with-domain-code">
<span id="tagging-samples-with-domain-code"></span><h2>Tagging samples with domain code<a class="headerlink" href="#tagging-samples-with-domain-code" title="Permalink to this headline">¶</a></h2>
<p>Use the function <code class="docutils literal notranslate"><span class="pre">pygslib.vtktools.pointinsolid</span></code> to label
composites in a domain defined by a closed wireframe. You can
also use this function to label samples in open surfaces (ej. between two
surfaces), below a surface and above a surface.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># importing the wireframe</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">domain</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">vtktools</span><span class="o">.</span><span class="n">loadSTL</span><span class="p">(</span><span class="s1">&#39;domain.stl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Only Stereo Lithography (*.STL) and XML VTK Polydata (*.VTP) file formats
are implemented. If your data is in a different format, ej. DXF, you can
use a file format converter, my favorite is
<a class="reference external" href="www.patrickmin.com/meshconv">meshconv</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># creating array to tag samples in domain1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inside1</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">vtktools</span><span class="o">.</span><span class="n">pointinsolid</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">x</span><span class="o">=</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;xm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">y</span><span class="o">=</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;ym&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">z</span><span class="o">=</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;zm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># creating a new domain field</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">inside1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># first 3 rows of a subtable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][[</span><span class="s1">&#39;BHID&#39;</span><span class="p">,</span> <span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="s1">&#39;TO&#39;</span><span class="p">,</span> <span class="s1">&#39;Domain&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">    BHID  FROM    TO  Domain</span>
<span class="go">0  34873   0.0  10.0       0</span>
<span class="go">1  34873  10.0  20.0       0</span>
<span class="go">2  34873  20.0  30.0       0</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># exporting results to VTK</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">export_core_vtk_line</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp.vtk&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Generated with PyGSLIB&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># exporting to csv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;cmp.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>A section of the wireframe and the drillholes may look as follows</p>
<p><img alt="" src="_images/figure2.jpg" /></p>
</div>
<div class="section" id="block-modeling">
<span id="block-modeling"></span><h2>Block modeling<a class="headerlink" href="#block-modeling" title="Permalink to this headline">¶</a></h2>
<p>Cu grades will be estimated on blocks inside the mineralized domain. To
create those blocks you may:</p>
<ul class="simple">
<li>create a block model object <code class="docutils literal notranslate"><span class="pre">pygslib.blockmodel.Blockmodel</span></code></li>
<li>fill the mineralized domain with blocks</li>
</ul>
<p>In PyGSLIB we use percent blocks. Our plan is implementing subcell style using Adaptive Mesh Refinement (AMR).</p>
<p>Blocks are stored in the class member <code class="docutils literal notranslate"><span class="pre">bmtable</span></code>, this is a Pandas
DataFrame with especial field index <code class="docutils literal notranslate"><span class="pre">IJK</span></code> or <code class="docutils literal notranslate"><span class="pre">[IX,IY,IZ]</span></code> and
coordinates <code class="docutils literal notranslate"><span class="pre">[XC,</span> <span class="pre">YC,</span> <span class="pre">ZC]</span></code>. We use GSLIB order, in other words,
<code class="docutils literal notranslate"><span class="pre">IJK</span></code> is the equivalent of the row number in a GSLIB grid.</p>
<p>Block model tables can be full or partial (with some missing blocks).
Only one table will be available in a block model object.</p>
<p>The block model definition is stored in the members
<code class="docutils literal notranslate"><span class="pre">nx,</span> <span class="pre">ny,</span> <span class="pre">nz,</span> <span class="pre">xorg,</span> <span class="pre">yorg,</span> <span class="pre">zorg,</span> <span class="pre">dx,</span> <span class="pre">dy,</span> <span class="pre">dz</span></code>. The origin
<code class="docutils literal notranslate"><span class="pre">xorg,</span> <span class="pre">yorg,</span> <span class="pre">zorg</span></code> refers to the lower left corner of the lower left
block (not the centroid), like in Datamine Studio.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># The model definition</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xorg</span> <span class="o">=</span> <span class="mi">2288230</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">yorg</span> <span class="o">=</span> <span class="mi">415200</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">zorg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dy</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dz</span> <span class="o">=</span> <span class="mi">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nx</span> <span class="o">=</span> <span class="mi">160</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ny</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nz</span> <span class="o">=</span> <span class="mi">90</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Creating an empty block model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">blockmodel</span><span class="o">.</span><span class="n">Blockmodel</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">xorg</span><span class="p">,</span><span class="n">yorg</span><span class="p">,</span><span class="n">zorg</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># filling wireframe with blocks</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">fillwireframe</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the fillwireframe function generates a field named  __in,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># this is the proportion inside the wireframe. Here we rename __in to D1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;__in&#39;</span><span class="p">:</span> <span class="s1">&#39;D1&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># creating a partial model by filtering out blocks with zero proportion inside the solid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">set_blocks</span><span class="p">(</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># export partial model to a VTK unstructured grid (*.vtu)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">blocks2vtkUnstructuredGrid</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;model.vtu&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">fillwireframe</span></code> created or overwrited <code class="docutils literal notranslate"><span class="pre">mymodel.bmtable</span></code>.
The blocks outside the wireframe where filtered out and the final output
is a partial model with block inside or touching the wireframe domain.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">fillwireframe</span></code> works with closed surfaces only.</p>
<p>A section view of the blocks colored by percentage inside the solid and
the wireframe (white lines) may look as follows:</p>
<p><img alt="" src="_images/figure3.jpg" /></p>
</div>
<div class="section" id="some-basic-stats">
<span id="some-basic-stats"></span><h2>Some basic stats<a class="headerlink" href="#some-basic-stats" title="Permalink to this headline">¶</a></h2>
<p>You may spend some time doing exploratory data analysis, looking at statistical
plots, 3D views and 2D sections of your data. A good comersial software for this
is <a class="reference external" href="http://opengeostat.com/software-solutions/">Supervisor</a>, open source
options are Pandas, <a class="reference external" href="http://statsmodels.sourceforge.net/">Statsmodels</a>,
<a class="reference external" href="https://stanford.edu/~mwaskom/software/seaborn/">Seaborn</a> and
<a class="reference external" href="http://glueviz.org/en/stable/">glueviz</a>.</p>
<p>PyGSLIB includes some minimum functionality for statistical plots and
calculations, with support for declustering wight. Here we demonstrate
how you can do a declustering analysis of the samples in the mineralized
domain and how to evaluate the declustered mean. The declustered mean
will be compared later with the mean of CU estimates.</p>
<p>Note: In this section we are not including all the statistical analysis
usually required for resource estimation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#declustering parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters_declus</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s1">&#39;x&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;xm&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;y&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ym&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;z&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;zm&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;vr&#39;</span>     <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;anisy&#39;</span>  <span class="p">:</span>  <span class="mf">1.</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;anisz&#39;</span>  <span class="p">:</span>  <span class="mf">0.05</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;minmax&#39;</span> <span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;ncell&#39;</span>  <span class="p">:</span>  <span class="mi">100</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;cmin&#39;</span>   <span class="p">:</span>  <span class="mf">100.</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;cmax&#39;</span>   <span class="p">:</span>  <span class="mf">5000.</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;noff&#39;</span>   <span class="p">:</span>  <span class="mi">8</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;maxcel&#39;</span> <span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># declustering</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wtopt</span><span class="p">,</span><span class="n">vrop</span><span class="p">,</span><span class="n">wtmin</span><span class="p">,</span><span class="n">wtmax</span><span class="p">,</span><span class="n">error</span><span class="p">,</span> \
<span class="gp">... </span> <span class="n">xinc</span><span class="p">,</span><span class="n">yinc</span><span class="p">,</span><span class="n">zinc</span><span class="p">,</span><span class="n">rxcs</span><span class="p">,</span><span class="n">rycs</span><span class="p">,</span><span class="n">rzcs</span><span class="p">,</span><span class="n">rvrcr</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">declus</span><span class="p">(</span><span class="n">parameters_declus</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#Plotting declustering optimization results</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">rxcs</span><span class="p">,</span> <span class="n">rvrcr</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X cell size&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;declustered mean&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">rycs</span><span class="p">,</span> <span class="n">rvrcr</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Y cell size&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;declustered mean&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">rzcs</span><span class="p">,</span> <span class="n">rvrcr</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Z cell size&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;declustered mean&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="_images/tutorial_53_0.png" />
<img alt="" src="_images/tutorial_53_1.png" />
<img alt="" src="_images/tutorial_53_2.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># parameters for declustering with the cell size selected</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters_declus</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s1">&#39;x&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;xm&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;y&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ym&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;z&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;zm&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;vr&#39;</span>     <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">],</span>
<span class="gp">... </span>       <span class="s1">&#39;anisy&#39;</span>  <span class="p">:</span>  <span class="mf">1.</span><span class="p">,</span>    <span class="c1"># y == x</span>
<span class="gp">... </span>       <span class="s1">&#39;anisz&#39;</span>  <span class="p">:</span>  <span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># z = x/20</span>
<span class="gp">... </span>       <span class="s1">&#39;minmax&#39;</span> <span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;ncell&#39;</span>  <span class="p">:</span>  <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;cmin&#39;</span>   <span class="p">:</span>  <span class="mf">1000.</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;cmax&#39;</span>   <span class="p">:</span>  <span class="mf">1000.</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;noff&#39;</span>   <span class="p">:</span>  <span class="mi">8</span><span class="p">,</span>
<span class="gp">... </span>       <span class="s1">&#39;maxcel&#39;</span> <span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># declustering</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wtopt</span><span class="p">,</span><span class="n">vrop</span><span class="p">,</span><span class="n">wtmin</span><span class="p">,</span><span class="n">wtmax</span><span class="p">,</span><span class="n">error</span><span class="p">,</span> \
<span class="gp">... </span>  <span class="n">xinc</span><span class="p">,</span><span class="n">yinc</span><span class="p">,</span><span class="n">zinc</span><span class="p">,</span><span class="n">rxcs</span><span class="p">,</span><span class="n">rycs</span><span class="p">,</span><span class="n">rzcs</span><span class="p">,</span><span class="n">rvrcr</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">declus</span><span class="p">(</span><span class="n">parameters_declus</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Adding declustering weight to a drillhole interval table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;declustwt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;declustwt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtopt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># calculating declustered mean</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decl_mean</span> <span class="o">=</span> <span class="n">rvrcr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Now we can calculate some declustered stats and plot declustered histogras</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare parameters dictionary</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;hmin&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>                          <span class="c1">#in/output rank-0 array(float,&#39;d&#39;)</span>
        <span class="s1">&#39;hmax&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>                         <span class="c1">#in/output rank-0 array(float,&#39;d&#39;)</span>
        <span class="s1">&#39;ncl&#39;</span>  <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>                            <span class="c1">#int, number of bins</span>
        <span class="s1">&#39;iwt&#39;</span>  <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                             <span class="c1">#int, 1 use declustering weight</span>
        <span class="s1">&#39;ilog&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                             <span class="c1">#int, 1 use logscale</span>
        <span class="s1">&#39;icum&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                             <span class="c1">#int, 1 use cumulative</span>
        <span class="s1">&#39;va&#39;</span>   <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">],</span>             <span class="c1"># array(&#39;d&#39;) with bounds (nd)</span>
        <span class="s1">&#39;wt&#39;</span>   <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;declustwt&#39;</span><span class="p">],</span>                          <span class="c1"># array(&#39;d&#39;) with bounds (nd), wight variable (obtained with declust?)</span>
        <span class="s1">&#39;figure&#39;</span> <span class="p">:</span> <span class="bp">None</span> <span class="p">,</span>                       <span class="c1"># a bokeh figure object (Optional: new figure created if None). Set none or undefined if creating a new figure.</span>
        <span class="s1">&#39;title&#39;</span>  <span class="p">:</span> <span class="s1">&#39;Hist Cu&#39;</span><span class="p">,</span>                    <span class="c1"># string. Figure title</span>
        <span class="s1">&#39;xlabel&#39;</span> <span class="p">:</span> <span class="s1">&#39;Cu (%)&#39;</span><span class="p">,</span> <span class="c1"># string. X axis label</span>
        <span class="s1">&#39;ylabel&#39;</span> <span class="p">:</span> <span class="s1">&#39;f(%)&#39;</span><span class="p">,</span> <span class="c1"># string. Y axis label</span>
        <span class="c1"># visual parameter for the histogram</span>
        <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="c1"># string with valid CSS colour (https://www.w3schools.com/colors/colors_names.asp), or an RGB(A) hex value, or tuple of integers (r,g,b), or tuple of (r,g,b,a)</span>
        <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="s1">&#39;Non - Declustered&#39;</span><span class="p">,</span> <span class="c1"># string (Optional, default &quot;NA&quot;)</span>
        <span class="s1">&#39;alpha&#39;</span> <span class="p">:</span>  <span class="mf">0.5</span><span class="p">,</span> <span class="c1"># float [0-1]. Transparency of the fill colour</span>
        <span class="s1">&#39;lwidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># float. Line width</span>
        <span class="c1"># legend</span>
        <span class="s1">&#39;legendloc&#39;</span><span class="p">:</span> <span class="s1">&#39;top_left&#39;</span><span class="p">}</span>  
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># calculate histogram</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">stats</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">plothtml</span><span class="o">.</span><span class="n">histgplt</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;xcvr&#39;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;xmen&#39;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;Min&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">])</span>
<span class="c1"># show the figure</span>
<span class="n">pygslib</span><span class="o">.</span><span class="n">plothtml</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="mf">1.4711890014945388</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="mf">0.2251903672467922</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;Min&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span> <span class="mf">15.4000001</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/bokeh_plot_1.png" /></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot CDF</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parameters_probplt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># gslib parameters for histogram calculation  </span>
        <span class="s1">&#39;iwt&#39;</span>  <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># input boolean (Optional: set True). Use weight variable?</span>
        <span class="s1">&#39;va&#39;</span>   <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;CU&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;CU&#39;</span><span class="p">],</span>             <span class="c1"># array(&#39;d&#39;) with bounds (nd)</span>
        <span class="s1">&#39;wt&#39;</span>   <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;CU&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;declustwt&#39;</span><span class="p">],</span>                          <span class="c1"># array(&#39;d&#39;) with bounds (nd), wight variable (obtained with declust?)</span>
        <span class="c1"># visual parameters for figure (if a new figure is created)</span>
        <span class="s1">&#39;figure&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c1"># a bokeh figure object (Optional: new figure created if None). Set none or undefined if creating a new figure.</span>
        <span class="s1">&#39;title&#39;</span>  <span class="p">:</span> <span class="s1">&#39;Prob blot&#39;</span><span class="p">,</span> <span class="c1"># string (Optional, &quot;Histogram&quot;). Figure title</span>
        <span class="s1">&#39;xlabel&#39;</span> <span class="p">:</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="c1"># string (Optional, default &quot;Z&quot;). X axis label</span>
        <span class="s1">&#39;ylabel&#39;</span> <span class="p">:</span> <span class="s1">&#39;P[Cu&lt;c]&#39;</span><span class="p">,</span> <span class="c1"># string (Optional, default &quot;f(%)&quot;). Y axis label</span>
        <span class="s1">&#39;xlog&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># boolean (Optional, default True). If true plot X axis in log sale.</span>
        <span class="s1">&#39;ylog&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># boolean (Optional, default True). If true plot Y axis in log sale.            </span>
        <span class="c1"># visual parameter for the probplt</span>
        <span class="s1">&#39;style&#39;</span> <span class="p">:</span> <span class="s1">&#39;cross&#39;</span><span class="p">,</span> <span class="c1"># string with valid bokeh chart type</span>
        <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="c1"># string with valid CSS colour (https://www.w3schools.com/colors/colors_names.asp), or an RGB(A) hex value, or tuple of integers (r,g,b), or tuple of (r,g,b,a) (Optional, default &quot;navy&quot;)</span>
        <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="s1">&#39;Declustered Cu&#39;</span><span class="p">,</span> <span class="c1"># string (Optional, default &quot;NA&quot;).</span>
        <span class="s1">&#39;alpha&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># float [0-1] (Optional, default 0.5). Transparency of the fill colour</span>
        <span class="s1">&#39;lwidth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># float (Optional, default 1). Line width</span>
        <span class="c1"># leyend</span>
        <span class="s1">&#39;legendloc&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom_right&#39;</span><span class="p">}</span> <span class="c1">#  float (Optional, default &#39;top_right&#39;). Any of top_left, top_center, top_right, center_right, bottom_right, bottom_center, bottom_left, center_left or center</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">results</span><span class="p">,</span> <span class="n">fig2</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">plothtml</span><span class="o">.</span><span class="n">probplt</span><span class="p">(</span><span class="n">parameters_probplt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># show the plot</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">plothtml</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/bokeh_plot_2.png" /></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;binval&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.35875964e-05</span><span class="p">,</span> <span class="mf">4.50984100e-05</span><span class="p">,</span> <span class="mf">2.94870422e-04</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
        <span class="mf">9.99926438e-01</span><span class="p">,</span> <span class="mf">9.99954949e-01</span><span class="p">,</span> <span class="mf">9.99984753e-01</span><span class="p">]),</span>
 <span class="s1">&#39;cl&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">9.99999980e-04</span><span class="p">,</span> <span class="mf">9.99999980e-04</span><span class="p">,</span> <span class="mf">1.00000001e-03</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
        <span class="mf">1.09999997e+01</span><span class="p">,</span> <span class="mf">1.43499999e+01</span><span class="p">,</span> <span class="mf">1.54000001e+01</span><span class="p">]),</span>
 <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;xcvr&#39;</span><span class="p">:</span> <span class="mf">0.9587717427220468</span><span class="p">,</span>
 <span class="s1">&#39;xlqt&#39;</span><span class="p">:</span> <span class="mf">0.1400000005</span><span class="p">,</span>
 <span class="s1">&#39;xmax&#39;</span><span class="p">:</span> <span class="mf">15.4000001</span><span class="p">,</span>
 <span class="s1">&#39;xmed&#39;</span><span class="p">:</span> <span class="mf">0.30100000042190583</span><span class="p">,</span>
 <span class="s1">&#39;xmen&#39;</span><span class="p">:</span> <span class="mf">0.30100000042190583</span><span class="p">,</span>
 <span class="s1">&#39;xmin&#39;</span><span class="p">:</span> <span class="mf">0.0009999999799999999</span><span class="p">,</span>
 <span class="s1">&#39;xpt025&#39;</span><span class="p">:</span> <span class="mf">0.014999999650000002</span><span class="p">,</span>
 <span class="s1">&#39;xpt975&#39;</span><span class="p">:</span> <span class="mf">1.0732820446853633</span><span class="p">,</span>
 <span class="s1">&#39;xuqt&#39;</span><span class="p">:</span> <span class="mf">0.525000006</span><span class="p">,</span>
 <span class="s1">&#39;xvar&#39;</span><span class="p">:</span> <span class="mf">0.12672198696392797</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="variography">
<span id="variography"></span><h2>Variography<a class="headerlink" href="#variography" title="Permalink to this headline">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="c1"># TODO</span>
</pre></div>
</div>
</div>
<div class="section" id="estimating-cu-grade-in-one-block">
<span id="estimating-cu-grade-in-one-block"></span><h2>Estimating Cu grade in one block<a class="headerlink" href="#estimating-cu-grade-in-one-block" title="Permalink to this headline">¶</a></h2>
<p>For estimation you may use the function <code class="docutils literal notranslate"><span class="pre">pygslib.gslib.kt3d</span></code>, which is
the GSLIB’s KT3D program modified and embedded into python. KT3D now
includes a maximum number of samples per drillhole in the search
ellipsoid and the estimation is only in the blocks provided as arrays.</p>
<p>The input parameters of <code class="docutils literal notranslate"><span class="pre">pygslib.gslib.kt3d</span></code> are defined in a large
and complicated dictionary. You can get this dictionary by typing</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="p">(</span><span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">kt3d</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that some parameters are optional. PyGSLIB will initialize those
parameters to zero or to array of zeros, for example if you exclude the
coordinate Z, PyGSLIB will create an array of zeros in its place.</p>
<p>To understand GSLIB’s KT3D parameters you may read the
<a class="reference external" href="www.amazon.ca/GSLIB-Geostatistical-Software-Library-Users/dp/0195100158">GSLIB user manual</a>
or <a class="reference external" href="www.statios.com/help/kt3d.html">the kt3d gslib program parameter documentation</a>.</p>
<p>Note that in PyGSLIB the parameters nx, ny and nz are only used by
superblock search algorithm, if these parameters are arbitrary the
output will be correct but the running time may be longer.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="c1"># creating parameter dictionary for estimation in one block</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kt3d_Parameters</span> <span class="o">=</span> <span class="p">{</span>
          <span class="c1"># Input Data (Only using intervals in the mineralized domain)</span>
          <span class="c1"># ----------</span>
          <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;xm&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;ym&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="s1">&#39;z&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;zm&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="s1">&#39;vr&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;CU&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="s1">&#39;bhidint&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;BHIDint&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="c1"># an interger BHID</span>
          <span class="c1"># Output (Target)</span>
          <span class="c1"># ----------</span>
          <span class="s1">&#39;nx&#39;</span> <span class="p">:</span> <span class="n">nx</span><span class="p">,</span>  
          <span class="s1">&#39;ny&#39;</span> <span class="p">:</span> <span class="n">ny</span><span class="p">,</span>  
          <span class="s1">&#39;nz&#39;</span> <span class="p">:</span> <span class="n">nz</span><span class="p">,</span>
          <span class="s1">&#39;xmn&#39;</span> <span class="p">:</span> <span class="n">xorg</span><span class="p">,</span>  
          <span class="s1">&#39;ymn&#39;</span> <span class="p">:</span> <span class="n">yorg</span><span class="p">,</span>  
          <span class="s1">&#39;zmn&#39;</span> <span class="p">:</span> <span class="n">zorg</span><span class="p">,</span>  
          <span class="s1">&#39;xsiz&#39;</span> <span class="p">:</span> <span class="n">dx</span><span class="p">,</span>  
          <span class="s1">&#39;ysiz&#39;</span> <span class="p">:</span> <span class="n">dy</span><span class="p">,</span>   
          <span class="s1">&#39;zsiz&#39;</span> <span class="p">:</span> <span class="n">dz</span><span class="p">,</span>
          <span class="s1">&#39;nxdis&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  
          <span class="s1">&#39;nydis&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  
          <span class="s1">&#39;nzdis&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  
          <span class="s1">&#39;outx&#39;</span> <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;XC&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;IJK&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1149229</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="c1"># filter to estimate only on block with IJK 1149229</span>
          <span class="s1">&#39;outy&#39;</span> <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;YC&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;IJK&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1149229</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="s1">&#39;outz&#39;</span> <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;ZC&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;IJK&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1149229</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="c1"># Search parameters</span>
          <span class="c1"># ----------</span>
          <span class="s1">&#39;radius&#39;</span>     <span class="p">:</span> <span class="mi">850</span><span class="p">,</span>   
          <span class="s1">&#39;radius1&#39;</span>    <span class="p">:</span> <span class="mi">850</span><span class="p">,</span>   
          <span class="s1">&#39;radius2&#39;</span>    <span class="p">:</span> <span class="mi">250</span><span class="p">,</span>   
          <span class="s1">&#39;sang1&#39;</span>      <span class="p">:</span> <span class="o">-</span><span class="mi">28</span><span class="p">,</span>  
          <span class="s1">&#39;sang2&#39;</span>      <span class="p">:</span> <span class="mi">34</span><span class="p">,</span>   
          <span class="s1">&#39;sang3&#39;</span>      <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>   
          <span class="s1">&#39;ndmax&#39;</span>      <span class="p">:</span> <span class="mi">12</span><span class="p">,</span>    
          <span class="s1">&#39;ndmin&#39;</span>      <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>  
          <span class="s1">&#39;noct&#39;</span>       <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s1">&#39;nbhid&#39;</span>      <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>   
          <span class="c1"># Kriging parameters and options</span>
          <span class="c1"># ----------</span>
          <span class="s1">&#39;ktype&#39;</span>      <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>   <span class="c1"># 1 Ordinary kriging</span>
          <span class="s1">&#39;idbg&#39;</span>       <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>   <span class="c1"># 0 no debug</span>
          <span class="c1"># Variogram parameters</span>
          <span class="c1"># ----------</span>
          <span class="s1">&#39;c0&#39;</span>         <span class="p">:</span> <span class="mf">0.35</span> <span class="o">*</span> <span class="mf">0.109758094158</span><span class="p">,</span>               <span class="c1"># we require not normalized variance for GCOS, fix... multiply for actual variance</span>
          <span class="s1">&#39;it&#39;</span>         <span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>    
          <span class="s1">&#39;cc&#39;</span>         <span class="p">:</span> <span class="p">[</span><span class="mf">0.41</span><span class="o">*</span><span class="mf">0.109758094158</span><span class="p">,</span><span class="mf">0.23</span><span class="o">*</span><span class="mf">0.109758094158</span><span class="p">],</span>
          <span class="s1">&#39;aa&#39;</span>         <span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">1117</span><span class="p">],</span>   
          <span class="s1">&#39;aa1&#39;</span>        <span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">1117</span><span class="p">],</span>  
          <span class="s1">&#39;aa2&#39;</span>        <span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">300</span><span class="p">],</span>   
          <span class="s1">&#39;ang1&#39;</span>       <span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">28</span><span class="p">,</span><span class="o">-</span><span class="mi">28</span><span class="p">],</span>   
          <span class="s1">&#39;ang2&#39;</span>       <span class="p">:</span> <span class="p">[</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>  
          <span class="s1">&#39;ang3&#39;</span>       <span class="p">:</span> <span class="p">[</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">]}</span>  
</pre></div>
</div>
<p>The variogram was calculated and modelled in a differnt software</p>
<p>The variogram types are as explained in http://www.gslib.com/gslib_help/vmtype.html, for example, <code class="docutils literal notranslate"><span class="pre">'it'</span> <span class="pre">:</span> <span class="pre">[2,2]</span></code> means two exponential models, in other words <code class="docutils literal notranslate"><span class="pre">[Exponential</span> <span class="pre">1,Exponential</span> <span class="pre">2]</span></code></p>
<p>Only the block with index <code class="docutils literal notranslate"><span class="pre">IJK</span></code> equal to <code class="docutils literal notranslate"><span class="pre">1149229</span></code> was used this time and <code class="docutils literal notranslate"><span class="pre">'idbg'</span></code> was set to one in order to get a full output of the last (and unique) block estimate, including the samples selected, kriging weight and the search ellipsoid.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># estimating in one block</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">estimate</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">kt3d</span><span class="p">(</span><span class="n">kt3d_Parameters</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/tutorial_58_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># saving debug to a csv file using Pandas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">debug</span><span class="p">[</span><span class="s1">&#39;dbgxdat&#39;</span><span class="p">],</span>
<span class="go">                  &#39;y&#39;:debug[&#39;dbgydat&#39;],</span>
<span class="go">                  &#39;z&#39;:debug[&#39;dbgzdat&#39;],</span>
<span class="go">                  &#39;wt&#39;:debug[&#39;dbgwt&#39;]}).to_csv(&#39;dbg_data.csv&#39;, index=False)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># save the search ellipse to a VTK file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pygslib</span><span class="o">.</span><span class="n">vtktools</span><span class="o">.</span><span class="n">SavePolydata</span><span class="p">(</span><span class="n">debug</span><span class="p">[</span><span class="s1">&#39;ellipsoid&#39;</span><span class="p">],</span> <span class="s1">&#39;search_ellipsoid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The results may look like this in Paraview.</p>
<p><img alt="" src="_images/figure4.jpg" /></p>
</div>
<div class="section" id="estimating-in-all-blocks">
<span id="estimating-in-all-blocks"></span><h2>Estimating in all blocks<a class="headerlink" href="#estimating-in-all-blocks" title="Permalink to this headline">¶</a></h2>
<p>After testing the estimation parameters in few blocks you may be ready
to estimate in all the blocks within the mineralized domain. Just update
the parameter file to remove the debug option and reassign the target
coordinates as the actual blocks coordinate arrays.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># update parameter file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;idbg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># set the debug of</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;outx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;XC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># use all the blocks</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;outy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;YC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;outz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;ZC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># estimating in all blocks</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">estimate</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">kt3d</span><span class="p">(</span><span class="n">kt3d_Parameters</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># adding the estimate into the model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimate</span><span class="p">[</span><span class="s1">&#39;outest&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_ID2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimate</span><span class="p">[</span><span class="s1">&#39;outidpower&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_NN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimate</span><span class="p">[</span><span class="s1">&#39;outnn&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_Lagrange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimate</span><span class="p">[</span><span class="s1">&#39;outlagrange&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_KVar&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">estimate</span><span class="p">[</span><span class="s1">&#39;outkvar&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># exporting block model to VTK (unstructured grid)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">blocks2vtkUnstructuredGrid</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;model.vtu&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># exporting to csv using Pandas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;model.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="validating-the-results">
<span id="validating-the-results"></span><h2>Validating the results<a class="headerlink" href="#validating-the-results" title="Permalink to this headline">¶</a></h2>
<p>There are few validations you may do:</p>
<ul class="simple">
<li>visual validation</li>
<li>comparison of mean grade</li>
<li>swath plots</li>
<li>global change of support (GCOS)</li>
</ul>
<p>Swath plots and GCOS are not implemented in PyGSLIB. For visual validations you can use Paraview, for example:
<img alt="" src="_images/figure5.jpg" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Mean in model OK   :&quot;</span><span class="p">,</span>  <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Mean in model ID2   :&quot;</span><span class="p">,</span>  <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_ID2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Mean in model NN   :&quot;</span><span class="p">,</span>  <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_NN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Mean in data    :&quot;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;CU&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Declustered mean:&quot;</span><span class="p">,</span> <span class="n">decl_mean</span><span class="p">)</span>
<span class="go">(&#39;Mean in model OK   :&#39;, 0.21166003)</span>
<span class="go">(&#39;Mean in model ID2   :&#39;, 0.20810474)</span>
<span class="go">(&#39;Mean in model NN   :&#39;, 0.20687895)</span>
<span class="go">(&#39;Mean in data    :&#39;, 0.24149141734342264)</span>
<span class="go">(&#39;Declustered mean:&#39;, 0.2251903672467954)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-swath-plots">
<span id="create-swath-plots"></span><h2>Create swath plots<a class="headerlink" href="#create-swath-plots" title="Permalink to this headline">¶</a></h2>
<p>There are two ways of doing swath plots</p>
<ul class="simple">
<li>Slicing block model and data and comparing the declustered means of each slice</li>
<li>Calculating nearest neighbour in blocks (this is equivalent to declustered values) and comparing means of nearest neighbour estimates with means of other estimation methods along row, columns and levels.</li>
</ul>
<p>We do not have a function in pygslib to do that, but we can implement the second option with one line of <code class="docutils literal notranslate"><span class="pre">pandas</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;XC&#39;</span><span class="p">)[[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">,</span><span class="s1">&#39;CU_ID2&#39;</span><span class="p">,</span><span class="s1">&#39;CU_NN&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="_images/swatplotX.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;XC&#39;</span><span class="p">)[[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">,</span><span class="s1">&#39;CU_ID2&#39;</span><span class="p">,</span><span class="s1">&#39;CU_NN&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="_images/swatplotY.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;XC&#39;</span><span class="p">)[[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">,</span><span class="s1">&#39;CU_ID2&#39;</span><span class="p">,</span><span class="s1">&#39;CU_NN&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="_images/swatplotZ.png" /></p>
</div>
<div class="section" id="global-change-of-support">
<span id="global-change-of-support"></span><h2>Global change of support<a class="headerlink" href="#global-change-of-support" title="Permalink to this headline">¶</a></h2>
<p>The tonnage over a cutoff \(c\) is related to the distribution \(P[Zv&lt;=c]\) of
grade values \(Z\) with block support \(v\). The tonnage (in % of the total tonnage)
is equal to \(P[Zv&gt;c] = 1-P[Zv&lt;=c]\) and the grade \(g\) over the
cutoff \(c\) is \(g=c+\sum_i(g_i*P_i)\), where \(g_i\) and \(P_i\) are the grade and
probability of discretization intervals \(i\) of the distribution \(P[Zv&lt;=c]\). This
is easy to see with an image.</p>
<p><img alt="" src="_images/gt_prob.png" /></p>
<p>In this example we assume that we mine with a hand shovel (volume proportional
to drillhole core) the ore (in red). Note that 20% of the samples are over the cutoff
(\(P[Zp&gt;c] = 0.2\)), then our tonnage is \(0.2 * T\) or 20% of the total tonnage.</p>
<p>If we decide to mine large blocks with size \(v\) then the shape of the CDF changes
and we will have a different average grade and tonnage, in this case
\(P[Zv&gt;c] \approx 0.09\). This is known as support effect.</p>
<p><img alt="" src="_images/gt_prob2.png" /></p>
<p>The idea behind the validation with global change of support is simple.</p>
<ul class="simple">
<li>calculate the distribution in point support (\(P[Zp&lt;=c]\))</li>
<li>fit it to a special mathematical model (using hermite polynomials)</li>
<li>calculate the support effect (which is a ‘reduction’ in variance)</li>
<li>deduce the block distribution (\(P[Zv&lt;=c]\)) and calculate grade and tonnage (G/T)
for different cutoff \(c\)</li>
<li>compare this theoretical G/T curves with G/T curves calculated with the model.</li>
</ul>
<p>Note that the global change of support is not impacted by the distance between
samples, it will give non-smoothed and accurate G/T curves if the total tonnage
\(T\) is correct, the variance within the block is properly calculated,
and the samples are representative of the mineralization.</p>
<p>You may need to decluster the point distribution \(P[Zp&lt;=c]\) if high or low grade
areas are selectively over-drilled (cluster effect).</p>
<div class="section" id="fitting-the-point-cdf-with-hermite-polynomials">
<span id="fitting-the-point-cdf-with-hermite-polynomials"></span><h3>Fitting the point CDF with hermite polynomials<a class="headerlink" href="#fitting-the-point-cdf-with-hermite-polynomials" title="Permalink to this headline">¶</a></h3>
<p>This is implemented in the module nonlinear</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit anamorphosis by changing, zmax, zmin, and extrapolation function</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">PCI</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">zana</span><span class="p">,</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">raw_var</span><span class="p">,</span> <span class="n">PCI_var</span><span class="p">,</span> <span class="n">fig1</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">anamor</span><span class="p">(</span>
       <span class="n">z</span> <span class="o">=</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">],</span>
       <span class="n">w</span> <span class="o">=</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;declustwt&#39;</span><span class="p">],</span>
       <span class="n">zmin</span> <span class="o">=</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
       <span class="n">zmax</span> <span class="o">=</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
       <span class="n">zpmin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">zpmax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
       <span class="n">ymin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
       <span class="n">ndisc</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
       <span class="n">ltail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">utail</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ltpar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">utpar</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">Raw</span> <span class="n">Variance</span> <span class="mf">0.109758094158</span>
<span class="n">Variance</span> <span class="kn">from</span> <span class="nn">PCI</span> <span class="mf">0.10922679995417846</span>
<span class="n">zamin</span> <span class="mf">0.01520555988670437</span>
<span class="n">zamax</span> <span class="mf">15.39374277733923</span>
<span class="n">yamin</span> <span class="o">-</span><span class="mf">0.26905381076215207</span>
<span class="n">yamax</span> <span class="mf">4.231846369273855</span>
<span class="n">zpmin</span> <span class="mf">0.0019999999599999998</span>
<span class="n">zpmax</span> <span class="mf">15.398035249048217</span>
<span class="n">ypmin</span> <span class="o">-</span><span class="mf">0.26905381076215207</span>
<span class="n">ypmax</span> <span class="mf">4.281856371274255</span>
</pre></div>
</div>
<p><img alt="" src="_images/anamor_p.png" /></p>
</div>
<div class="section" id="calculate-the-support-effect">
<span id="calculate-the-support-effect"></span><h3>Calculate the support effect<a class="headerlink" href="#calculate-the-support-effect" title="Permalink to this headline">¶</a></h3>
<p>This is specific to the discrete gaussian model. We need to known the PCI,
the hermite coefficients and the block variance (output of
pygslib.gslib.block_covariance and debug[‘cbb’] wen debug is set to 1
in the function <code class="docutils literal notranslate"><span class="pre">estimate,</span> <span class="pre">debug,</span> <span class="pre">summary</span> <span class="pre">=</span> <span class="pre">pygslib.gslib.kt3d(kt3d_Parameters)</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">get_r</span><span class="p">(</span><span class="n">Var_Zv</span> <span class="o">=</span> <span class="n">cbb</span><span class="p">,</span> <span class="n">PCI</span> <span class="o">=</span> <span class="n">PCI</span><span class="p">)</span>
<span class="go">(&#39;cbb :&#39;, 0.0310319369001521)</span>
<span class="go">(&#39;r   :&#39;, 0.6192572191827116)</span>
</pre></div>
</div>
</div>
<div class="section" id="correcting-the-support-effect-on-the-cdf">
<span id="correcting-the-support-effect-on-the-cdf"></span><h3>Correcting the support effect on the CDF<a class="headerlink" href="#correcting-the-support-effect-on-the-cdf" title="Permalink to this headline">¶</a></h3>
<p>Here we use the discrete gaussian model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ZV</span><span class="p">,</span> <span class="n">PV</span><span class="p">,</span> <span class="n">fig2</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">anamor_blk</span><span class="p">(</span> <span class="n">PCI</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">gauss</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span>
<span class="go">                  ltail=1, utail=1, ltpar=1, utpar=1,</span>
<span class="go">                  raw=raw, zana=zana)</span>
</pre></div>
</div>
<p><img alt="" src="_images/anamor_v.png" /></p>
</div>
<div class="section" id="calculate-grade-tonnage-curves">
<span id="calculate-grade-tonnage-curves"></span><h3>Calculate grade tonnage curves<a class="headerlink" href="#calculate-grade-tonnage-curves" title="Permalink to this headline">¶</a></h3>
<p>We calculate G/T curves using the hermite model in block support.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># calculate GTC from gaussian in block support</span>
<span class="n">t</span><span class="p">,</span><span class="n">ga</span><span class="p">,</span><span class="n">gb</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">gtcurve</span> <span class="p">(</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">ZV</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">PV</span><span class="p">,</span> <span class="n">varred</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ivtyp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
             <span class="n">ltail</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ltpar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">middle</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">utail</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">utpar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">maxdis</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">tt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ga</span><span class="p">)</span>
<span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;DGM with block support&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">plotgt</span><span class="p">(</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">tt</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gg</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/gtc_p.png" /></p>
<p>Now, we calculate the CDF from the block model, this is just one of the many ways of doing this</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># to compare global resources with the one estimated we calculate the CDF of the blocks</span>

<span class="c1"># cdf of kriging estimate</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parameters_probplt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;iwt&#39;</span>  <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                             <span class="c1">#int, 1 use declustering weight</span>
        <span class="s1">&#39;va&#39;</span>   <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>             <span class="c1"># array(&#39;d&#39;) with bounds (nd)</span>
        <span class="s1">&#39;wt&#39;</span>   <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span> <span class="c1"># array(&#39;d&#39;) with bounds (nd), wight variable (obtained with declust?)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">binval_ok</span><span class="p">,</span><span class="n">cl_ok</span><span class="p">,</span><span class="n">xpt025</span><span class="p">,</span><span class="n">xlqt</span><span class="p">,</span><span class="n">xmed</span><span class="p">,</span><span class="n">xuqt</span><span class="p">,</span><span class="n">xpt975</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span> \
        <span class="n">xcvr</span><span class="p">,</span><span class="n">xmen</span><span class="p">,</span><span class="n">xvar</span><span class="p">,</span><span class="n">error</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">__plot</span><span class="o">.</span><span class="n">probplt</span><span class="p">(</span><span class="o">**</span><span class="n">parameters_probplt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="c1"># cdf of id2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parameters_probplt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;iwt&#39;</span>  <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                             <span class="c1">#int, 1 use declustering weight</span>
        <span class="s1">&#39;va&#39;</span>   <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_ID2&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>             <span class="c1"># array(&#39;d&#39;) with bounds (nd)</span>
        <span class="s1">&#39;wt&#39;</span>   <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span> <span class="c1"># array(&#39;d&#39;) with bounds (nd), wight variable (obtained with declust?)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">binval_id2</span><span class="p">,</span><span class="n">cl_id2</span><span class="p">,</span><span class="n">xpt025</span><span class="p">,</span><span class="n">xlqt</span><span class="p">,</span><span class="n">xmed</span><span class="p">,</span><span class="n">xuqt</span><span class="p">,</span><span class="n">xpt975</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span> \
       <span class="n">xcvr</span><span class="p">,</span><span class="n">xmen</span><span class="p">,</span><span class="n">xvar</span><span class="p">,</span><span class="n">error</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">__plot</span><span class="o">.</span><span class="n">probplt</span><span class="p">(</span><span class="o">**</span><span class="n">parameters_probplt</span><span class="p">)</span>
</pre></div>
</div>
<p>And calculate G/T curves of blocks</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># calculate GTC ok</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">,</span><span class="n">ga</span><span class="p">,</span><span class="n">gb</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">gtcurve</span> <span class="p">(</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">cl_ok</span><span class="p">,</span>
<span class="go">               p=binval_ok, varred = 1, ivtyp = 2, zmin = 0, zmax = None,</span>
<span class="go">              ltail = 1, ltpar = 1, middle = 1, mpar = 1, utail = 1,</span>
<span class="go">              utpar = 1,maxdis = 1000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ga</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Ordinary Kriging&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># calculate GTC in block support</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">,</span><span class="n">ga</span><span class="p">,</span><span class="n">gb</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">gtcurve</span> <span class="p">(</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">cl_id2</span><span class="p">,</span>
<span class="go">              p=binval_id2, varred = 1, ivtyp = 2, zmin = 0, zmax = None,</span>
<span class="go">              ltail = 1, ltpar = 1, middle = 1, mpar = 1, utail = 1,</span>
<span class="go">              utpar = 1,maxdis = 1000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ga</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Inverse of the Distance 2)&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">plotgt</span><span class="p">(</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">tt</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gg</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/gt_all.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># we can plot diferences (relative error in grade)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">gg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">gg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;DGM - OK&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">gg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">gg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;DGM - ID2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cutoff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero error&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;relative error in grade&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="_images/gt_allb.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># we can plot diferences (relative error in tonnage)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;DGM - OK&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">tt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;DGM - ID2&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cutoff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero error&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;relative error in tonnage&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/gt_allc.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># To get tonnes right just multiply per total tonnes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># calcullate tottal tonnage (million tonnes)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttonnes</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="o">*</span><span class="mi">100</span><span class="o">*</span><span class="mi">30</span><span class="o">*</span> <span class="mf">0.0283168</span> <span class="o">*</span>  <span class="mf">2.7</span> <span class="o">/</span><span class="mi">1000000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># cubic foot to m -&gt; 0.0283168, density 2.7</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttt</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ttonnes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#plot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">ttt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cutoff&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/gt_alld.png" /></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="API.html" class="btn btn-neutral float-right" title="PyGSLIB API autogenerated documentation!" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to PyGSLIB documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Adrian Martinez Vargas.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.0.3.9',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
